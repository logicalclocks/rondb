include/rpl/init_source_replica.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the connection metadata repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection master]
#
# Setup filters on the Slave.
#
[connection slave]
include/rpl/stop_replica.inc
Warnings:
Note	3084	Replication thread(s) for channel '' are already stopped.
CHANGE REPLICATION FILTER REPLICATE_REWRITE_DB=        ((db1, db2));
CHANGE REPLICATION FILTER REPLICATE_IGNORE_TABLE=      (test.itable);
CHANGE REPLICATION FILTER REPLICATE_DO_TABLE=          (test.t1);
CHANGE REPLICATION FILTER REPLICATE_WILD_DO_TABLE=     ('test.t%');
CHANGE REPLICATION FILTER REPLICATE_WILD_IGNORE_TABLE= ('test.i%');
CHANGE REPLICATION FILTER REPLICATE_IGNORE_DB=         (nodb);
CHANGE REPLICATION FILTER REPLICATE_DO_DB=             (test, db1, db2);
CHANGE REPLICATION SOURCE TO SOURCE_HOST='127.0.0.1', SOURCE_USER='root', SOURCE_PORT=MASTER_MYPORT FOR CHANNEL 'ch1';

SELECT FILTER_NAME, FILTER_RULE, CONFIGURED_BY FROM performance_schema.replication_applier_global_filters ORDER BY FILTER_NAME;
FILTER_NAME	FILTER_RULE	CONFIGURED_BY
REPLICATE_DO_DB	test,db1,db2	CHANGE_REPLICATION_FILTER
REPLICATE_DO_TABLE	test.t1	CHANGE_REPLICATION_FILTER
REPLICATE_IGNORE_DB	nodb	CHANGE_REPLICATION_FILTER
REPLICATE_IGNORE_TABLE	test.itable	CHANGE_REPLICATION_FILTER
REPLICATE_REWRITE_DB	(db1,db2)	CHANGE_REPLICATION_FILTER
REPLICATE_WILD_DO_TABLE	test.t%	CHANGE_REPLICATION_FILTER
REPLICATE_WILD_IGNORE_TABLE	test.i%	CHANGE_REPLICATION_FILTER
SELECT COUNT(*) FROM performance_schema.replication_applier_filters;
COUNT(*)
14
SELECT FILTER_NAME, FILTER_RULE, CONFIGURED_BY, COUNTER FROM performance_schema.replication_applier_filters WHERE CHANNEL_NAME='ch1' ORDER BY FILTER_NAME;
FILTER_NAME	FILTER_RULE	CONFIGURED_BY	COUNTER
REPLICATE_DO_DB	test,db1,db2	CHANGE_REPLICATION_FILTER	0
REPLICATE_DO_TABLE	test.t1	CHANGE_REPLICATION_FILTER	0
REPLICATE_IGNORE_DB	nodb	CHANGE_REPLICATION_FILTER	0
REPLICATE_IGNORE_TABLE	test.itable	CHANGE_REPLICATION_FILTER	0
REPLICATE_REWRITE_DB	(db1,db2)	CHANGE_REPLICATION_FILTER	0
REPLICATE_WILD_DO_TABLE	test.t%	CHANGE_REPLICATION_FILTER	0
REPLICATE_WILD_IGNORE_TABLE	test.i%	CHANGE_REPLICATION_FILTER	0
#
# Verify that filters doesn't reset by
# "RESET REPLICA [FOR CHANNEL 'ch1']" command.
#
RESET BINARY LOGS AND GTIDS;
RESET REPLICA;
RESET REPLICA FOR CHANNEL 'ch1';

SELECT FILTER_NAME, FILTER_RULE, CONFIGURED_BY FROM performance_schema.replication_applier_global_filters ORDER BY FILTER_NAME;
FILTER_NAME	FILTER_RULE	CONFIGURED_BY
REPLICATE_DO_DB	test,db1,db2	CHANGE_REPLICATION_FILTER
REPLICATE_DO_TABLE	test.t1	CHANGE_REPLICATION_FILTER
REPLICATE_IGNORE_DB	nodb	CHANGE_REPLICATION_FILTER
REPLICATE_IGNORE_TABLE	test.itable	CHANGE_REPLICATION_FILTER
REPLICATE_REWRITE_DB	(db1,db2)	CHANGE_REPLICATION_FILTER
REPLICATE_WILD_DO_TABLE	test.t%	CHANGE_REPLICATION_FILTER
REPLICATE_WILD_IGNORE_TABLE	test.i%	CHANGE_REPLICATION_FILTER
SELECT COUNT(*) FROM performance_schema.replication_applier_filters;
COUNT(*)
14
SELECT FILTER_NAME, FILTER_RULE, CONFIGURED_BY, COUNTER FROM performance_schema.replication_applier_filters WHERE CHANNEL_NAME='ch1' ORDER BY FILTER_NAME;
FILTER_NAME	FILTER_RULE	CONFIGURED_BY	COUNTER
REPLICATE_DO_DB	test,db1,db2	CHANGE_REPLICATION_FILTER	0
REPLICATE_DO_TABLE	test.t1	CHANGE_REPLICATION_FILTER	0
REPLICATE_IGNORE_DB	nodb	CHANGE_REPLICATION_FILTER	0
REPLICATE_IGNORE_TABLE	test.itable	CHANGE_REPLICATION_FILTER	0
REPLICATE_REWRITE_DB	(db1,db2)	CHANGE_REPLICATION_FILTER	0
REPLICATE_WILD_DO_TABLE	test.t%	CHANGE_REPLICATION_FILTER	0
REPLICATE_WILD_IGNORE_TABLE	test.i%	CHANGE_REPLICATION_FILTER	0
#
# Verify the channel and per channel filters are removed
# after "RESET REPLICA [ALL] [FOR CHANNEL 'ch1']" command.
#
RESET REPLICA ALL FOR CHANNEL 'ch1';

SELECT FILTER_NAME, FILTER_RULE, CONFIGURED_BY FROM performance_schema.replication_applier_global_filters ORDER BY FILTER_NAME;
FILTER_NAME	FILTER_RULE	CONFIGURED_BY
REPLICATE_DO_DB	test,db1,db2	CHANGE_REPLICATION_FILTER
REPLICATE_DO_TABLE	test.t1	CHANGE_REPLICATION_FILTER
REPLICATE_IGNORE_DB	nodb	CHANGE_REPLICATION_FILTER
REPLICATE_IGNORE_TABLE	test.itable	CHANGE_REPLICATION_FILTER
REPLICATE_REWRITE_DB	(db1,db2)	CHANGE_REPLICATION_FILTER
REPLICATE_WILD_DO_TABLE	test.t%	CHANGE_REPLICATION_FILTER
REPLICATE_WILD_IGNORE_TABLE	test.i%	CHANGE_REPLICATION_FILTER
SELECT COUNT(*) FROM performance_schema.replication_applier_filters;
COUNT(*)
7
SELECT FILTER_NAME, FILTER_RULE, CONFIGURED_BY, COUNTER FROM performance_schema.replication_applier_filters WHERE CHANNEL_NAME='ch1' ORDER BY FILTER_NAME;
FILTER_NAME	FILTER_RULE	CONFIGURED_BY	COUNTER
RESET REPLICA ALL;

SELECT FILTER_NAME, FILTER_RULE, CONFIGURED_BY FROM performance_schema.replication_applier_global_filters ORDER BY FILTER_NAME;
FILTER_NAME	FILTER_RULE	CONFIGURED_BY
REPLICATE_DO_DB	test,db1,db2	CHANGE_REPLICATION_FILTER
REPLICATE_DO_TABLE	test.t1	CHANGE_REPLICATION_FILTER
REPLICATE_IGNORE_DB	nodb	CHANGE_REPLICATION_FILTER
REPLICATE_IGNORE_TABLE	test.itable	CHANGE_REPLICATION_FILTER
REPLICATE_REWRITE_DB	(db1,db2)	CHANGE_REPLICATION_FILTER
REPLICATE_WILD_DO_TABLE	test.t%	CHANGE_REPLICATION_FILTER
REPLICATE_WILD_IGNORE_TABLE	test.i%	CHANGE_REPLICATION_FILTER
SELECT COUNT(*) FROM performance_schema.replication_applier_filters;
COUNT(*)
0
SELECT FILTER_NAME, FILTER_RULE, CONFIGURED_BY, COUNTER FROM performance_schema.replication_applier_filters WHERE CHANNEL_NAME='' ORDER BY FILTER_NAME;
FILTER_NAME	FILTER_RULE	CONFIGURED_BY	COUNTER
CHANGE REPLICATION SOURCE TO SOURCE_HOST='127.0.0.1', SOURCE_USER='root', SOURCE_PORT=MASTER_MYPORT;

SELECT FILTER_NAME, FILTER_RULE, CONFIGURED_BY FROM performance_schema.replication_applier_global_filters ORDER BY FILTER_NAME;
FILTER_NAME	FILTER_RULE	CONFIGURED_BY
REPLICATE_DO_DB	test,db1,db2	CHANGE_REPLICATION_FILTER
REPLICATE_DO_TABLE	test.t1	CHANGE_REPLICATION_FILTER
REPLICATE_IGNORE_DB	nodb	CHANGE_REPLICATION_FILTER
REPLICATE_IGNORE_TABLE	test.itable	CHANGE_REPLICATION_FILTER
REPLICATE_REWRITE_DB	(db1,db2)	CHANGE_REPLICATION_FILTER
REPLICATE_WILD_DO_TABLE	test.t%	CHANGE_REPLICATION_FILTER
REPLICATE_WILD_IGNORE_TABLE	test.i%	CHANGE_REPLICATION_FILTER
SELECT COUNT(*) FROM performance_schema.replication_applier_filters;
COUNT(*)
7
SELECT FILTER_NAME, FILTER_RULE, CONFIGURED_BY, COUNTER FROM performance_schema.replication_applier_filters WHERE CHANNEL_NAME='' ORDER BY FILTER_NAME;
FILTER_NAME	FILTER_RULE	CONFIGURED_BY	COUNTER
REPLICATE_DO_DB	test,db1,db2	CHANGE_REPLICATION_FILTER	0
REPLICATE_DO_TABLE	test.t1	CHANGE_REPLICATION_FILTER	0
REPLICATE_IGNORE_DB	nodb	CHANGE_REPLICATION_FILTER	0
REPLICATE_IGNORE_TABLE	test.itable	CHANGE_REPLICATION_FILTER	0
REPLICATE_REWRITE_DB	(db1,db2)	CHANGE_REPLICATION_FILTER	0
REPLICATE_WILD_DO_TABLE	test.t%	CHANGE_REPLICATION_FILTER	0
REPLICATE_WILD_IGNORE_TABLE	test.i%	CHANGE_REPLICATION_FILTER	0
#
# Clean up and Verify filter gets reset through
# CHANGE REPLICATION FILTER command
#
CHANGE REPLICATION FILTER REPLICATE_REWRITE_DB=        ();
CHANGE REPLICATION FILTER REPLICATE_IGNORE_TABLE=      ();
CHANGE REPLICATION FILTER REPLICATE_DO_TABLE=          ();
CHANGE REPLICATION FILTER REPLICATE_WILD_DO_TABLE=     ();
CHANGE REPLICATION FILTER REPLICATE_WILD_IGNORE_TABLE= ();
CHANGE REPLICATION FILTER REPLICATE_IGNORE_DB=         ();
CHANGE REPLICATION FILTER REPLICATE_DO_DB=             ();

SELECT FILTER_NAME, FILTER_RULE, CONFIGURED_BY FROM performance_schema.replication_applier_global_filters ORDER BY FILTER_NAME;
FILTER_NAME	FILTER_RULE	CONFIGURED_BY
REPLICATE_DO_DB		CHANGE_REPLICATION_FILTER
REPLICATE_DO_TABLE		CHANGE_REPLICATION_FILTER
REPLICATE_IGNORE_DB		CHANGE_REPLICATION_FILTER
REPLICATE_IGNORE_TABLE		CHANGE_REPLICATION_FILTER
REPLICATE_REWRITE_DB		CHANGE_REPLICATION_FILTER
REPLICATE_WILD_DO_TABLE		CHANGE_REPLICATION_FILTER
REPLICATE_WILD_IGNORE_TABLE		CHANGE_REPLICATION_FILTER
SELECT COUNT(*) FROM performance_schema.replication_applier_filters;
COUNT(*)
7
SELECT CHANNEL_NAME, FILTER_NAME, FILTER_RULE, CONFIGURED_BY, COUNTER FROM performance_schema.replication_applier_filters ORDER BY FILTER_NAME;
CHANNEL_NAME	FILTER_NAME	FILTER_RULE	CONFIGURED_BY	COUNTER
	REPLICATE_DO_DB		CHANGE_REPLICATION_FILTER	0
	REPLICATE_DO_TABLE		CHANGE_REPLICATION_FILTER	0
	REPLICATE_IGNORE_DB		CHANGE_REPLICATION_FILTER	0
	REPLICATE_IGNORE_TABLE		CHANGE_REPLICATION_FILTER	0
	REPLICATE_REWRITE_DB		CHANGE_REPLICATION_FILTER	0
	REPLICATE_WILD_DO_TABLE		CHANGE_REPLICATION_FILTER	0
	REPLICATE_WILD_IGNORE_TABLE		CHANGE_REPLICATION_FILTER	0
include/rpl/start_replica.inc
include/rpl/deinit.inc
