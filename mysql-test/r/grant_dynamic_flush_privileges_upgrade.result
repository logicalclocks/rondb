#
# WL#16044 : Provide Separate Privilege For FLUSH PRIVILEGES
#
# Before revoking privileges.
SELECT GRANTEE, PRIVILEGE_TYPE, IS_GRANTABLE FROM INFORMATION_SCHEMA.USER_PRIVILEGES
WHERE PRIVILEGE_TYPE LIKE 'FLUSH_PRIVILEGES' ORDER BY 1,2,3;
GRANTEE	PRIVILEGE_TYPE	IS_GRANTABLE
'root'@'localhost'	FLUSH_PRIVILEGES	YES
REVOKE FLUSH_PRIVILEGES ON *.* FROM root@localhost;
# After revoking privileges.
SELECT GRANTEE, PRIVILEGE_TYPE, IS_GRANTABLE FROM INFORMATION_SCHEMA.USER_PRIVILEGES
WHERE PRIVILEGE_TYPE LIKE 'FLUSH_PRIVILEGES' ORDER BY 1,2,3;
GRANTEE	PRIVILEGE_TYPE	IS_GRANTABLE
# Create two test users. With and without reload privilege.
CREATE USER test@localhost, test_no_reload@localhost;
GRANT RELOAD ON *.* TO test@localhost;
# Should contain root@localhost and test@localhost
SELECT GRANTEE, PRIVILEGE_TYPE, IS_GRANTABLE FROM INFORMATION_SCHEMA.USER_PRIVILEGES
WHERE PRIVILEGE_TYPE = 'RELOAD' ORDER BY 1,2,3;
GRANTEE	PRIVILEGE_TYPE	IS_GRANTABLE
'root'@'localhost'	RELOAD	YES
'test'@'localhost'	RELOAD	NO
# restart:--upgrade=FORCE
# Restart server with defaults
# restart:
# After upgrade, root and test user shall have FLUSH_PRIVILEGES privilege.
SELECT GRANTEE, PRIVILEGE_TYPE, IS_GRANTABLE FROM INFORMATION_SCHEMA.USER_PRIVILEGES
WHERE PRIVILEGE_TYPE LIKE 'FLUSH_PRIVILEGES' ORDER BY 1,2,3;
GRANTEE	PRIVILEGE_TYPE	IS_GRANTABLE
'root'@'localhost'	FLUSH_PRIVILEGES	YES
'test'@'localhost'	FLUSH_PRIVILEGES	NO
# Cleanup
DROP USER test@localhost, test_no_reload@localhost;
