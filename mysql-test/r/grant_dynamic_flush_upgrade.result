# FR7: test upgrade
REVOKE FLUSH_TABLES, FLUSH_USER_RESOURCES, FLUSH_STATUS,
FLUSH_OPTIMIZER_COSTS, FLUSH_PRIVILEGES ON *.* FROM root@localhost;
# Should be empty
SELECT GRANTEE, PRIVILEGE_TYPE, IS_GRANTABLE FROM INFORMATION_SCHEMA.USER_PRIVILEGES
WHERE PRIVILEGE_TYPE LIKE 'FLUSH_%' ORDER BY 1,2,3;
GRANTEE	PRIVILEGE_TYPE	IS_GRANTABLE
CREATE USER wl14303@localhost, wl14303_no_reload@localhost;
GRANT RELOAD ON *.* TO wl14303@localhost;
# Should contain root@localhost and wl14303@localhost
SELECT GRANTEE, PRIVILEGE_TYPE, IS_GRANTABLE FROM INFORMATION_SCHEMA.USER_PRIVILEGES
WHERE PRIVILEGE_TYPE = 'RELOAD' ORDER BY 1,2,3;
GRANTEE	PRIVILEGE_TYPE	IS_GRANTABLE
'root'@'localhost'	RELOAD	YES
'wl14303'@'localhost'	RELOAD	NO
# restart:--upgrade=FORCE
# Restart server with defaults
# restart:
# Success criteria: should contain 8 rows: 5 for root and 5 for wl14303
SELECT GRANTEE, PRIVILEGE_TYPE, IS_GRANTABLE FROM INFORMATION_SCHEMA.USER_PRIVILEGES
WHERE PRIVILEGE_TYPE LIKE 'FLUSH_%' ORDER BY 1,2,3;
GRANTEE	PRIVILEGE_TYPE	IS_GRANTABLE
'root'@'localhost'	FLUSH_OPTIMIZER_COSTS	YES
'root'@'localhost'	FLUSH_PRIVILEGES	YES
'root'@'localhost'	FLUSH_STATUS	YES
'root'@'localhost'	FLUSH_TABLES	YES
'root'@'localhost'	FLUSH_USER_RESOURCES	YES
'wl14303'@'localhost'	FLUSH_OPTIMIZER_COSTS	NO
'wl14303'@'localhost'	FLUSH_PRIVILEGES	NO
'wl14303'@'localhost'	FLUSH_STATUS	NO
'wl14303'@'localhost'	FLUSH_TABLES	NO
'wl14303'@'localhost'	FLUSH_USER_RESOURCES	NO
DROP USER wl14303@localhost, wl14303_no_reload@localhost;
# Cleanup
# End of 8.0 tests
